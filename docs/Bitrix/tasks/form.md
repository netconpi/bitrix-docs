# Задание на форму

Owner: Misha Kovalev
Verification: Verified
Tags: zdorovprod-task

# Задание на форму обратной связи:

1. Создать тип ИБ в котором будут хранится результаты ФОРМ (их на сайте не 1, аля заранее на будущее) (поэтому лучше сделать новый тип) 
    1. По мит(-у) доп полей не обсудили. Добавлять не нужно. Все в PREVIEW_TEXT, аля формируете письмо на отправку 
2. Размещение формы: 
    1. Форму расположить в самом начале страницы и отобразить в нужном месте; (усложнение) 
    
    Для реализации прочитать про CMain::ShowViewContent, AddViewContent, SetViewTarget, EndViewTarget → прочитайте про них и выберите 1 набор, который нужен) 
    
3. Реализация формы
    1. Форма по мимо основных данных должна хранить в себе (изначально) → тег form: 
        1. Ссылку на товар (не обяз)
        2. Полный путь к товару 
        3. Наименование товара 
        
        Данные поля реализовать через **input hidden** с прописанными value/name 
        
    2. Основные поля должны собираться по классике
    3. Сбор данных, у вас есть кнопка типа submit которая будет
        
        При нажатии на кнопку (событие click с preventdefault): 
        
        - Собираете все данные и не по полям, а автоматический. Использовать можно различные методы. Например [FormData](https://learn.javascript.ru/formdata) / Можете погуглить еще методы
        - Проверяете что все собрано и на месте
        - Отправляете Ajax запрос в ваш файл
        - Получаете ответ (удачно/нет)
        - Желательно отобразить ошибку если нет (console.log(); если там не предусмотрена обработка ошибок с бэка)
4. Файл который будет обрабатывать Ajax
    1. Получаете данные 
    2. Валидируете данные, проверяете, что все пришло как нужно 
        1. Есть маска у телефона и почты. Вам проще всего будет проверить все через regex
    3. Формируете текст который запишите в PREVIEW_TEXT
    4. Через CIBlockElement::Add добавляете элемент, в котором название будет: название формы **(задать вопрос по продукту)**
    5. После удачи/ ошибки вернуть ответ на фронт

- Мега здорово будет прочитать что такое CSRF и интегрировать его в форму для дальнейшей обработки
- Так же здорово будет, пред сохранением данных в ИБ прочитать что такое **htmlspecialchars** и тд
- Для реализации взаимодействия Клиент→Сервер используйте [https://dev.1c-bitrix.ru/api_help/js_lib/ajax/index.php](https://dev.1c-bitrix.ru/api_help/js_lib/ajax/index.php) (настоятельно рекомендую)

## Детальнее по реализации запроса:

метод: POST
Желательная проверка (погуглить): `$_SERVER['HTTP_X_REQUESTED_WITH'] == 'XMLHttpRequest' && $request->isPost()`

CSRF: `bitrix_sessid_post() // bitrix_sessid()`

Отдача ответа Ajax: (ПРОЧИТАЙТЕ, А НЕ КОПИРУЙТЕ)
`header('Content-Type: application/json');`

`json_encode();`