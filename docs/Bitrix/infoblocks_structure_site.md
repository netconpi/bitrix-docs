# Общее обсуждение: структура компонента, выполнение страницы битрикс, все о инфоблоках

## Компоненты

**Компонент** - это логически завершённый код, предназначенный для извлечения информации из инфоблоков и других источников и преобразования её в HTML-код для отображения в виде фрагментов web-страниц. Состоит из собственно компонента (контроллер) и шаблона (представление). Компонент, с помощью API одного или нескольких модулей, манипулирует данными. Шаблон компонента выводит данные на страницу.

> Схема работы функционального компонента
> 
> 
> ![Untitled](/static/1.png)
> 

### **Простые компоненты**

**Простые** (обычные, одностраничные) компоненты **создают какую-либо область** на одной странице. Их удобно использовать, когда на одной странице требуется разместить данные из различных модулей (блоги и инфоблоки, например) или данные из разных инфоблоков (новости и каталог товаров). Для создания полного раздела новостей или каталога товаров пользоваться ими довольно неудобно: приходится создавать большое число статических страниц и следить за тем, чтобы они были корректно связаны друг с другом.

### **Комплексные компоненты**

**Комплексные** (сложные, многостраничные) компоненты создают **разделы сайта**. Например, компонент каталога создает на сайте весь раздел каталога: список каталогов, список групп и страницы товаров. То есть, **комплексный компонент состоит из набора динамических страниц** при просмотре сайта, но из одной статической страницы на физическом уровне. Комплексные компоненты строятся на основе простых, используя их логику.

### Структура компонента

| Функциональный компонент | Объектно-ориентированный компонент |
| --- | --- |
| подпапка /lang — файлы языковых сообщений (переводов) | подпапка /lang — файлы языковых сообщений (переводов) |
| подпапка /templates — шаблоны вывода (отображения) компонента | подпапка /templates — шаблоны вывода (отображения) компонента |
| файл component.php —  содержит логику (код) компонента | файл https://dev.1c-bitrix.ru/learning/course/index.php?COURSE_ID=43&LESSON_ID=2028 — содержит логику (код) компонента |
| файл https://dev.1c-bitrix.ru/learning/course/index.php?COURSE_ID=43&LESSON_ID=2828, который содержит название, описание компонента и его положение в дереве логического размещения (для редактора). | файл https://dev.1c-bitrix.ru/learning/course/index.php?COURSE_ID=43&LESSON_ID=2828, который содержит название, описание компонента и его положение в дереве логического размещения (для редактора). |
| файл https://dev.1c-bitrix.ru/learning/course/index.php?COURSE_ID=43&LESSON_ID=2132, который содержит описание входных параметров компонента для редактора. | файл https://dev.1c-bitrix.ru/learning/course/index.php?COURSE_ID=43&LESSON_ID=2132, который содержит описание входных параметров компонента для редактора. |
| файл script.js, может подключаться из шаблона, а может из кода компонента | файл script.js, может подключаться из шаблона, а может из кода компонента |
| любые другие папки и файлы с ресурсами, необходимыми компоненту, например, папка /images | любые другие папки и файлы с ресурсами, необходимыми компоненту, например, папка /images |

### Шаблон компонента

**Системные шаблоны** поставляются вместе в дитрибутиве и лежат в подпапке **templates** папки компонента.

**Пользовательские шаблоны** компонента - шаблоны, которые изменены под нужды конкретного сайта. Они должны лежать в папках шаблонов сайтов (т.е. в **`/local/templates/шаблон_сайта/`**). При таком расположении шаблона при копировании шаблона средствами системы, они будут расположены по следующему пути: **`/local/templates/шаблон_сайта/components/namespace/название_компонента/название_шаблона`**.

**Переменные, доступные в шаблоне компонента**

Используются следующие переменные:

- **`$templateFile`** – путь к шаблону относительно корня сайта, например **`/bitrix/components/bitrix/iblock.list/templates/.default/template.php`**).
- **`$arResult`** – массив результатов работы компонента.
- **`$arParams`** – массив входящих параметров компонента, может использоваться для учета заданных параметров при выводе шаблона (например, отображении детальных изображений или ссылок).
- **`$arLangMessages`** – массив языковых сообщений (для php шаблонов не устанавливается).
- **`$templateFolder`** – путь к папке с шаблоном от DOCUMENT_ROOT (например **`/bitrix/components/bitrix/iblock.list/templates/.default`**).
- **`$parentTemplateFolder`** - путь относительно корня сайта к папке шаблона комплексного компонента, в составе которого подключается данный компонент (если компонент подключается самостоятельно, то эта переменная пуста).
- **`$component`** – ссылка на текущий вызванный компонент (тип [CBitrixComponent](http://dev.1c-bitrix.ru/api_help/main/reference/cbitrixcomponent/index.php)).
- **`$this`** - ссылка на текущий шаблон (объект, описывающий шаблон, тип [CBitrixComponentTemplate](http://dev.1c-bitrix.ru/api_help/main/reference/cbitrixcomponenttemplate/index.php))
- **`$templateName`** – имя шаблона (например: **.dеfault**)
- **`$componentPath`** – путь к папке с компонентом от DOCUMENT_ROOT (напр. **`/bitrix/components/bitrix/iblock.list`**)
- **`$templateData`** – массив для записи, обратите внимание, таким образом можно передать данные из **template.php** в файл **component_epilog.php**, причем эти данные попадают в кеш, т.к. файл **component_epilog.php** исполняется на каждом хите.

Кроме того внутри PHP шаблона объявлены глобальными переменные **`$APPLICATION`**, **`$USER`**, **`$DB`**.

**Шаблон простого компонента**

Папка шаблона простого компонента может содержать следующие подпапки и файлы:

- подпапку **`/lang`**, в которой расположены файлы языковых сообщений (переводов);
- файл [result_modifier.php](http://dev.1c-bitrix.ru/learning/course/index.php?COURSE_ID=43&CHAPTER_ID=02830), который подключается непосредственно перед подключением шаблона компонента. Этот файл получает на вход массив результатов работы компонента **`$arResult`** и массив параметров его вызова **`$arParams`**. Таким образом, можно, например, изменить массив результатов работы компонента под конкретный шаблон.
- файл [component_epilog.php](https://dev.1c-bitrix.ru/learning/course/index.php?COURSE_ID=43&CHAPTER_ID=02975), который подключается после исполнения шаблона.
- файл **style.css**, который определяет необходимы стили.
- файл **script.js**, который определяет и подключает необходимые яваскрипты. Этот файл может отсутствовать.
- файл **.description.php**, который содержит название и описание шаблона для визуального редактора.
- файл **.parameters.php**, который содержит описание дополнительных входных параметров шаблона для визуального редактора.
- файл **template.ext**, который и является собственно шаблоном. Расширение **ext** зависит от того, какой движок шаблонизации нужно подключать. **По умолчанию расширение равно** **php**. Этот файл должен обязательно присутствовать.
- любые другие папки и файлы с ресурсами, необходимыми шаблону компонента. Например, папка **image**, содержащая изображения.

## **Страница и порядок её выполнения**

| п/п | Операция | Описание  |
| --- | --- | --- |
| 1 | Подключение /bitrix/php_interface/dbconn.php | Подключаемый файл должен содержать определения https://dev.1c-bitrix.ru/api_help/main/general/magic_vars.php#dbtype для соединения с базой данных, https://dev.1c-bitrix.ru/api_help/main/general/constants.php#error_email и https://dev.1c-bitrix.ru/api_help/main/general/constants.php#bx_file_permissions. Обычно он настроен в VMBitrix и тд.  |
| 2 | Подключение к БД | Без БД сайт — не сайт. Вернет $DB. В случае ошибки запишет лог |
| 3 | /bitrix/php_interface/after_connect.php | Маловероятно что будет нужно. А так: операции, необходимые для выполнения сразу после соединения с БД |
| 4 | Определение текущего сайта, инициализация базовых классов  | $APPLICATION, SITE_ID, SITE_DIR, SITE_SERVER_NAME, SITE_CHARSET, FORMAT_DATE, FORMAT_DATETIME, LANGUAGE_ID,
Определяются все классы и функции Главного модуля. |
| 5 | /bitrix/php_interface/init.php | Для чего? Инициализацию обработчиков событий, подключение дополнительных функций - общие для всех сайтов!. |
| 6 | /local/php_interface/init.php | Тоже самое. Тока тут уже менять все можно! |
| 7 | Открытие сессии | Вообще сюда много что можно писать. Обычно храниться в куки. https://www.php.net/manual/ru/intro.session.php#:~:text=Введение%20¶&text=Каждому%20посетителю%20сайта%20присваивается%20уникальный,пользователя%2C%20либо%20передаётся%20через%20URL.  |
| 8 | Событие https://dev.1c-bitrix.ru/api_help/main/events/onpagestart.php | Мы его можем обработать и че-нить сделать  |
| 9 | Определение пользователя, авторизация пользователя, завершение сеанса, регистрация (в зависимости от параметров в запросе) | $USER |
| 10 | Определение текущего https://dev.1c-bitrix.ru/api_help/main/general/template.php | SITE_TEMPLATE_ID |
| 11 | Событие https://dev.1c-bitrix.ru/api_help/main/events/onbeforeprolog.php | Мы его можем обработать и че-нить сделать  |
|  | Проверка прав доступа уровня 1 |  |
|  | Начало буфферизации вывода |  |
| 12 | Событие https://dev.1c-bitrix.ru/api_help/main/events/onprolog.php | Мы его можем обработать и че-нить сделать |
| 13 | Подключение шаблона | Подключение хедера  |
|  | Тело страницы #WORK_AREA# |  |
| 14 | Подключение шаблона | Подключение футера  |
|  | Вызов функции https://dev.1c-bitrix.ru/api_help/main/reference/cmain/showspreadcookiehtml.php |  |
| 15 | Событие https://dev.1c-bitrix.ru/api_help/main/events/onepilog.php | Мы его можем обработать и че-нить сделать |
| 16 | Завершение буферизации страницы |  |
| 17 | Событие https://dev.1c-bitrix.ru/api_help/main/events/onafterepilog.php | Мы его можем обработать и че-нить сделать |
| 18 | Проверка https://dev.1c-bitrix.ru/learning/course/index.php?COURSE_ID=43&LESSON_ID=3436 | Они будут нужны, про них надо читать!!! |
| 19 | https://dev.1c-bitrix.ru/api_help/main/reference/cevent/checkevents.php | Ага, тут |
| 20 | https://dev.1c-bitrix.ru/api_help/main/reference/cdatabase/disconnect.php | Что открыли, то закрыли  |

## Информационные блоки

Модуль **Информационные блоки** - мощный и в то же время гибкий механизм для хранения и выборки информации различными способами. API модуля состоит из нескольких высокоуровневых функций для выборки данных в публичном разделе сайта и набора классов с низкоуровневыми методами для более специализированной работы.

### Публичные функции и возвращаемые значения

| Метод | Описание |
| --- | --- |
| https://dev.1c-bitrix.ru/api_help/iblock/functions/getiblocklist.php | Возвращает список информационных блоков по фильтру. |
| https://dev.1c-bitrix.ru/api_help/iblock/functions/getiblock.php | Возвращает информационный блок по заданному коду. |
| https://dev.1c-bitrix.ru/api_help/iblock/functions/getiblockelementlistex.php | Возвращает список элементов по фильтру. |
| https://dev.1c-bitrix.ru/api_help/iblock/functions/getiblockelementlist.php | Возвращает список элементов из определённого информационного блока. |
| https://dev.1c-bitrix.ru/api_help/iblock/functions/getiblockelement.php | Возвращает элемент по заданному коду. |
| https://dev.1c-bitrix.ru/api_help/iblock/functions/getiblocksectionlist.php | Возвращает список папок из определённого информационного блока. |
| https://dev.1c-bitrix.ru/api_help/iblock/functions/getiblocksection.php | Возвращает раздел по заданному коду. |

### Классы модуля информационных блоков

| Класс | Описание |
| --- | --- |
| https://dev.1c-bitrix.ru/api_help/iblock/classes/ciblock/index.php | Класс для работы с информационными блоками. |
| https://dev.1c-bitrix.ru/api_help/iblock/classes/ciblockcmlexport/index.php | Класс для экспорта данных инфоблока в xml-формате. |
| https://dev.1c-bitrix.ru/api_help/iblock/classes/ciblockcmlimport/index.php | Класс для импорта данных инфоблока в xml-формате. |
| https://dev.1c-bitrix.ru/api_help/iblock/classes/ciblockelement/index.php | Класс для работы с элементами информационных блоков. |
| https://dev.1c-bitrix.ru/api_help/iblock/classes/ciblockformatproperties/dateformat.php |  |
| https://dev.1c-bitrix.ru/api_help/iblock/classes/ciblockpricetools/canbuy.php |  |
| https://dev.1c-bitrix.ru/api_help/iblock/classes/ciblockproperty/index.php | класс для работы со свойствами информационных блоков. |
| https://dev.1c-bitrix.ru/api_help/iblock/classes/ciblockpropertyenum/index.php | Класс для работы с вариантами значений для свойств типа "список". |
| https://dev.1c-bitrix.ru/api_help/iblock/classes/ciblockresult/index.php | Вспомогательный класс для работы с объектами результатов выборок. |
| https://dev.1c-bitrix.ru/api_help/iblock/classes/ciblockrss/index.php | Класс для работы с RSS лентами. |
| https://dev.1c-bitrix.ru/api_help/iblock/classes/ciblocksection/index.php | Класс для работы с группами информационных блоков. |
| https://dev.1c-bitrix.ru/api_help/iblock/classes/ciblocktype/index.php | Класс для работы с типами информационных блоков. |
| https://dev.1c-bitrix.ru/api_help/iblock/classes/ciblockxmlfile/index.php | Класс для работы с файлами XML. |
| https://dev.1c-bitrix.ru/api_help/iblock/classes/user_properties/index.php | Позволяют изменять представление (формы ввода и т.п.) стандартных свойств расширяя их возможности. |
| https://dev.1c-bitrix.ru/api_help/iblock/classes/_cibelement/index.php | Вспомогательный класс для работы с объектом выборки элемента. |

### Форма создания инфоблоков, вкладки

- **Инфоблок** - содержит настройки общих параметров информационного блока. Подробную информацию по заполнению полей данной вкладки читайте в уроке Основные настройки.
- **SEO** - служит для настройки шаблонов SEO данных сразу целиком для всех разделов и элементов инфоблока. Подробности в уроке Настройка SEO данных в инфоблоке.
- **Поля** и **Поля разделов** - вкладки, которые позволяют задать предустановленные данные для полей форм элементов и разделов инфоблока. Выполненные настройки на этих вкладках очень облегчают работу контент-менеджеров по наполнению инфоблока материалами.
- **Свойства** - содержит список свойств (собственных полей) для элементов инфоблока. О работе со свойствами читайте в уроке Свойства элементов.
- **RSS** - содержит параметры выгрузки данных в RSS. Вкладка не отображается, если не отмечена опция Использовать экспорт в RSS в настройках типа инфоблока. Подробнее о настройках данной вкладки смотрите в [документации по продукту](https://dev.1c-bitrix.ru/user_help/content/iblock/iblock_edit.php#rss).
- **Торговый каталог** - параметры вкладки настраиваются только в том случае, если инфоблок необходимо настроить на работу в режиме торгового каталога. Дальнейшую работу с разделами, элементами и свойствами инфоблока рекомендуется вести в разделе Магазин .
- **Доступ** - задание прав на доступ к данному инфоблоку. Помните про следующую особенность системы: даже если задан доступ к странице, на которой выводятся материалы инфоблока, но не задан доступ к материалам инфоблока, то посетитель не увидит информацию на сайте.
- **Подписи** - позволяет задать новые заголовки объектов инфоблока.
- **Шаблоны бизнес-процессов** - доступна только при наличии в системе модуля **Бизнес-процессы** и при выборе на вкладке **Инфоблок** в выпадающем списке **Участвует в документообороте или бизнес процессах** значения **бизнес процессы**. Подробнее о бизнес-процессах читайте в специальном учебном курсе.
- **Журнал изменений** - выбираются параметры, которые нужно контролировать с помощью одноименного компонента.

### Свойства инфоблоков

| Поле | Описание |
| --- | --- |
| ID | Идентификатор свойства элементов информационного блока. |
| Название | Произвольное название свойства элементов инфоблока. Доступно 255 знаков. |
| Тип | Тип свойства: 
• Строка - значение свойства задается в виде текстовой строки;
• Число - значение свойства задается в виде числа;
• Список - значение свойства выбирается из списка;
• Файл - в качестве значения свойства используется файл;
• Деньги - Привязка к валюте;
• Привязка к разделам- с помощью данного свойства можно задать связь между элементом данного инфоблока и разделами другого информационного блока;
• Привязка к элементам - задание связи между элементами информационных блоков "поштучно";
• HTML/текст - значение свойства задается в виде текста с HTML-тегами;
• Видео - задается связь между элементом списка и медиафайлом;
• Дата - значение свойства задается в виде даты без указания времени;
• Дата/Время - значение свойства задается в виде даты/времени;
• Привязка к Яндекс.Карте - задается связь между элементом инфоблока и компонентом Яндекс.Карта;
• Привязка к карте Google Maps - задается связь между элементом инфоблока и компонентом Google Map;
• Привязка к пользователю - с помощью данного свойства можно задать связь между элементом данного инфоблока и пользователями системы;
• Привязка к разделам с автозаполнением - задается связь с разделами с автозаполнением;
• Привязка к теме форума - с помощью данного свойства можно задать связь между элементом данного инфоблока и темами форума;
• Привязка к товарам (SKU) - задается связь с товарными предложениями;
• Привязка к файлу (на сервере) - с помощью данного свойства можно задать связь между элементом инфоблока и файлом на сервере;
• Привязка к элементам в виде списка - задание связи между элементами списком;
• Привязка к элементам по XML_ID - привязка хранится как строка и значением является xml_id привязанного элемента;
• Привязка к элементам с автозаполнением - задается связь с элементами с автозаполнением;
• Справочник - задается связь между элементами инфоблока и записями Highload-блока. Данный тип свойства доступен только при наличии установленного модуля Highload-блоки;
• Счетчик - Аналог autoincrement для БД. При добавлении элемента инфоблока значение будет больше на единицу, чем последнее. Стартовое значение задается произвольное. Можно использовать для журналов учета входящих документов и т.п., где должна быть непрерывная нумерация документов.Каждый тип свойств характеризуется собственным набором параметров, настраиваемых в форме https://dev.1c-bitrix.ru/user_help/content/iblock/iblock_edit_property.php. |
| Акт. | Признак активности свойства (если свойство активно, оно может быть выбрано для показа в публичной части сайта). |
| Множ. | Признак множественности свойства. Т.е. для данного свойства может быть задано несколько значений. Количество полей для ввода значений определяется в форме детального редактирования свойства (кнопка Изменить). |
| Обяз. | Признак обязательности свойства. Т.е. для данного свойства должно быть обязательно задано значение. |
| Сорт. | Относительный "вес" свойства. Влияет на положение свойства в списке. |
| Код | Мнемонический код свойства. Может состоять из латинских символов (рекомендуется использовать символы верхнего регистра) и цифр, но не должен начинаться с цифры. |
| Изм. | Кнопка, при нажатии на которую открывается форма детального редактирования свойства (см. https://dev.1c-bitrix.ru/user_help/content/iblock/iblock_edit_property.php). |
| Удал. | Для удаления свойства установите флаг в это поле и нажмите кнопку "Сохранить". |

### Более детальное описание всего остального в ифнормационных блоках можно найти по ссылке

[https://dev.1c-bitrix.ru/user_help/content/iblock/iblock_edit.php](https://dev.1c-bitrix.ru/user_help/content/iblock/iblock_edit.php)

> **НЕ ОБЯЗАТЕЛЬНОЕ И МОЖЕТ ЗАПУТАТЬ**
> 
> 
> ### Разница между информационными блоками первой и второй версий
> 
> Существует две версии инфоблоков: первая и вторая. Они отличаются по следующим параметрам:
> 
> - **Структура данных**.
>     - **В первой версии** инфоблоков данные хранятся **в трех таблицах**: b_iblock, b_iblock_element и b_iblock_property.
>     - **Во второй версии** инфоблоков данные хранятся **в семи таблицах**: b_iblock, b_iblock_element, b_iblock_element_prop_s, b_iblock_element_prop_m, b_iblock_property, b_iblock_property_enum и b_iblock_section3. Это позволяет более гибко и эффективно работать с данными, особенно с множественными свойствами и разделами.
> - API. В первой версии инфоблоков для работы с данными используется класс CIBlockElement. Во второй версии инфоблоков для работы с данными используется класс CIBlockElement и его наследники CIBlockElementEnum и CIBlockElement/Section. Это позволяет более удобно и безопасно обращаться к данным, а также использовать ORM-модель.
> - Компоненты. В первой версии инфоблоков для отображения данных на сайте используются старые компоненты, которые начинаются с префикса iblock. Во второй версии инфоблоков для отображения данных на сайте используются новые компоненты, которые начинаются с префикса bitrix. Это позволяет более легко и быстро настраивать внешний вид и функционал компонентов, а также использовать шаблоны и параметры.